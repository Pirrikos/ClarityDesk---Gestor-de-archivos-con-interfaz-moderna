ClarityDesk Pro - Árbol de Estructura
=====================================
Fecha: 29 de noviembre de 2025 (Actualizado según análisis completo)

C:.
│   .gitignore
│   README.md
│   arbol.txt                        # Documentación de estructura del proyecto
│   CLEAR_STRUCTURE.md               # Estructura clara del proyecto
│   main.py                          # Punto de entrada principal
│   main.spec                        # Especificación PyInstaller
│   requirements.txt                 # Dependencias Python
│   run.bat                          # Ejecución rápida en Windows
│   check_python.bat                 # Verificación de entorno Python
│   verify_dependencies.bat          # Comprobación de dependencias
│
├───.trae
│   └───rules
│           project_rules.md         # Reglas de arquitectura activas (v2.1)
│
├───INFORMES                         # Documentación y reportes de auditoría
│   │   ANALISIS_CODIGO_MUERTO.md
│   │   ANALISIS_PROYECTO.md
│   │   AUDITORIA_CALIDAD_RAPIDA.md
│   │   AUDITORIA_COMPLETA_REGLAS.md
│   │   AUDITORIA_EXHAUSTIVA_COMPLETA.md
│   │   AUDITORIA_EXHAUSTIVA_CURSORRULES.md
│   │   AUDITORIA_EXHAUSTIVA_FINAL.md
│   │   AUDITORIA_FINAL.md
│   │   AUDITORIA_FINAL_COMPLETA.md
│   │   AUDITORIA_FINAL_REGLAS.md
│   │   AUDITORIA_HONESTA.md
│   │   AUDITORIA_PROFUNDA.md
│   │   CORRECCIONES_APLICADAS.md
│   │   FASE1_COMPLETADA.md
│   │   FASE1_TABMANAGER_COMPLETADA.md
│   │   FASE2_COMPLETADA.md
│   │   FASE3_COMPLETADA.md
│   │   FASE4_COMPLETADA.md
│   │   FASE5_COMPLETADA.md
│   │   FLUJO_RENDERIZADO_ICONOS.md
│   │   INFORME_DE_ESTADO.md
│   │   INFORME_INCUMPLIMIENTO_REGLAS.md
│   │   MIGRACION_CONTROLLERS_COMPLETA.md
│   │   REFACTORIZACION_COMPLETA.md
│   │   REFACTOR_TAB_MANAGER_MAPEO.md
│   │   REFACTOR_TAB_MANAGER_RESULTADO.md
│   │
│   └───Reglas Principales
│
├───app                              # Paquete principal de la aplicación
│   │   __init__.py
│   │
│   ├───assets                       # Recursos locales de app
│   │   └───icons
│   │           README.md
│   │           folder_sidebar.svg
│   │
│   ├───core                         # Core module (vacío, reservado)
│   │       __init__.py
│   │
│   ├───data                         # Datos de configuración
│   │       rename_templates.json    # Plantillas de renombrado
│   │
│   ├───managers                     # Gestores de coordinación (9 archivos)
│   │   │   __init__.py
│   │   │   file_state_manager.py   # Gestor de estados con caché SQLite
│   │   │   files_manager.py         # Orquestador de operaciones de archivos
│   │   │   focus_manager.py         # Orquestador de Focus (wrapper ligero)
│   │   │   tab_manager.py           # Gestor central de tabs (250 líneas)
│   │   │   tab_manager_actions.py   # Acciones de tabs (254 líneas)
│   │   │   tab_manager_init.py      # Inicialización de TabManager
│   │   │   tab_manager_restore.py   # Restauración de estado
│   │   │   tab_manager_signals.py   # Manejo de señales
│   │   │   tab_manager_state.py     # Gestión de estado persistente
│   │
│   ├───models                       # Modelos de datos puros (2 archivos)
│   │   │   __init__.py
│   │   │   file_operation_result.py # Resultado de operaciones (success/error)
│   │   │   file_stack.py            # Agrupación de archivos por tipo
│   │
│   ├───services                     # Servicios de lógica de negocio (59 archivos)
│   │   │   __init__.py
│   │   │
│   │   ├─── Tab Management (9 archivos)
│   │   │   tab_state_manager.py     # Gestión de estado de tabs
│   │   │   tab_storage_service.py   # Persistencia JSON de tabs
│   │   │   tab_history_manager.py   # Historial de navegación
│   │   │   tab_navigation_handler.py # Manejo de navegación back/forward
│   │   │   tab_helpers.py           # Utilidades consolidadas (normalización, búsqueda, validación)
│   │   │   tab_manager_init.py      # Inicialización de TabManager (setup watcher)
│   │   │
│   │   ├─── File Operations (9 archivos)
│   │   │   file_list_service.py     # Listado de archivos con filtrado
│   │   │   file_scan_service.py     # Escaneo de carpetas
│   │   │   file_filter_service.py   # Filtrado por extensiones
│   │   │   file_stack_service.py    # Agrupación de archivos por tipo
│   │   │   file_move_service.py     # Movimiento de archivos
│   │   │   file_delete_service.py  # Eliminación de archivos
│   │   │   file_rename_service.py   # Renombrado de archivos
│   │   │   file_open_service.py    # Apertura con sistema
│   │   │   file_path_utils.py      # Utilidades de rutas
│   │   │   file_extensions.py      # Extensiones soportadas
│   │   │
│   │   ├─── Icons & Preview (24 archivos)
│   │   │   icon_service.py          # Servicio principal de iconos Windows (198 líneas)
│   │   │   icon_render_service.py  # Renderizado con normalización
│   │   │   preview_service.py      # Generación de previews (alias de PreviewPdfService)
│   │   │   preview_pdf_service.py  # Servicio de previews PDF/DOCX
│   │   │   icon_renderer.py        # Renderizador base
│   │   │   icon_renderer_pdf.py    # Renderizado PDFs
│   │   │   icon_renderer_image.py  # Renderizado imágenes
│   │   │   icon_renderer_svg.py    # Renderizado SVGs
│   │   │   icon_renderer_docx.py   # Renderizado DOCX
│   │   │   icon_renderer_constants.py # Constantes de renderizado
│   │   │   icon_batch_worker.py    # Worker para generación batch de iconos
│   │   │   pdf_render_worker.py    # Worker para renderizado PDF
│   │   │   docx_convert_worker.py  # Worker para conversión DOCX
│   │   │   icon_normalizer.py      # Normalización visual
│   │   │   icon_processor.py       # Procesamiento de iconos
│   │   │   icon_fallback_helper.py # Fallbacks de iconos
│   │   │   icon_conversion_helper.py # Conversión de iconos
│   │   │   icon_extraction_fallbacks.py # Fallbacks de extracción
│   │   │   preview_scaling.py      # Escalado de previews
│   │   │   pixel_analyzer.py       # Análisis de píxeles
│   │   │   windows_icon_extractor.py # Extracción de iconos Windows
│   │   │   windows_icon_converter.py # Conversión HICON
│   │   │   pdf_renderer.py         # Renderizado PDFs
│   │   │   docx_converter.py      # Conversión DOCX
│   │   │
│   │   ├─── File State Storage (6 archivos)
│   │   │   file_state_storage.py   # Módulo principal (re-exporta APIs)
│   │   │   file_state_storage_helpers.py # Helpers (DB path, conexión, file ID)
│   │   │   file_state_storage_init.py # Inicialización y schema
│   │   │   file_state_storage_crud.py # Operaciones CRUD individuales
│   │   │   file_state_storage_batch.py # Operaciones batch
│   │   │   file_state_storage_rename.py # Operaciones de renombrado
│   │   │
│   │   ├─── Trash (3 archivos)
│   │   │   trash_storage.py        # Almacenamiento de papelera
│   │   │   trash_operations.py     # Operaciones (mover, restaurar)
│   │   │   trash_limits.py         # Límites (edad/tamaño)
│   │   │
│   │   ├─── Desktop (5 archivos)
│   │   │   desktop_operations.py   # Operaciones de escritorio
│   │   │   desktop_operations_scan.py # Escaneo de escritorio
│   │   │   desktop_path_helper.py  # Detección de rutas Desktop
│   │   │   desktop_drag_ops.py     # Operaciones drag & drop escritorio
│   │   │   desktop_visibility.py  # Visibilidad de escritorio
│   │   │
│   │   └─── System Services (4 archivos)
│   │       filesystem_watcher_service.py # Observador de cambios del sistema de archivos
│   │       workspace_service.py    # Servicio de workspace
│   │       settings_service.py     # Gestión de configuración
│   │       rename_service.py       # Servicio de renombrado masivo
│   │
│   ├───storage                      # Estado simple (JSON)
│   │       dock_tabs.json
│   │       trash_tabs.json
│   │
│   ├───tests                        # Tests de app
│   │       test_sidebar_double_click_sequence.py
│   │       test_sidebar_double_click.py
│   │
│   └───ui                           # Interfaz de usuario (Qt)
│       │   __init__.py
│       │
│       ├───widgets                  # Componentes reutilizables (73 archivos)
│       │   │   __init__.py
│       │   │
│       │   ├─── FileGridView (9 archivos)
│       │   │   file_grid_view.py           # Widget principal de vista cuadrícula
│       │   │   grid_content_widget.py      # Widget de contenido del grid
│       │   │   grid_layout_engine.py       # Motor de layout del grid
│       │   │   grid_layout_config.py      # Configuración del layout
│       │   │   file_grid_view_layout.py   # Setup de layout
│       │   │   file_grid_view_events.py   # Manejo de eventos
│       │   │   file_grid_view_drag.py     # Drag & drop
│       │   │   file_grid_view_scroll.py   # Scroll area
│       │   │   grid_tile_builder.py       # Construcción de tiles
│       │   │
│       │   ├─── FileTile (9 archivos)
│       │   │   file_tile.py                # Widget principal de tile de archivo
│       │   │   file_tile_setup.py          # Setup de UI
│       │   │   file_tile_events.py         # Eventos mouse/drag
│       │   │   file_tile_paint.py          # Pintado personalizado
│       │   │   file_tile_icon.py           # Gestión de iconos
│       │   │   file_tile_drag.py           # Drag & drop
│       │   │   file_tile_anim.py           # Animaciones
│       │   │   file_tile_states.py         # Estados visuales
│       │   │   file_tile_controller.py     # Control de selección
│       │   │
│       │   ├─── FileListView (8 archivos)
│       │   │   file_list_view.py           # Widget principal de vista lista
│       │   │   file_list_renderer.py       # Renderizado de filas
│       │   │   file_list_handlers.py       # Manejo de eventos
│       │   │   list_row_factory.py         # Factory de filas
│       │   │   list_icon_delegate.py       # Delegate de iconos
│       │   │   list_state_cell.py          # Celda de estado
│       │   │   list_checkbox.py            # Checkbox de lista
│       │   │   list_styles.py              # Estilos de lista
│       │   │
│       │   ├─── FileViewContainer (5 archivos)
│       │   │   file_view_container.py       # Contenedor principal (grid + list)
│       │   │   file_view_setup.py          # Setup de UI
│       │   │   file_view_sync.py           # Sincronización entre vistas
│       │   │   file_view_tabs.py           # Manejo de tabs
│       │   │   file_view_handlers.py       # Handlers de eventos
│       │   │
│       │   ├─── FocusDockWidget (6 archivos)
│       │   │   focus_dock_widget.py        # Widget principal del dock
│       │   │   focus_dock_layout.py        # Layout del dock
│       │   │   focus_dock_handlers.py      # Handlers de eventos
│       │   │   focus_dock_update_helpers.py # Helpers de actualización
│       │   │   focus_header_panel.py       # Panel de encabezado
│       │   │   subfolder_overlay.py       # Overlay de subcarpetas
│       │   │
│       │   ├─── FocusStackTile (5 archivos)
│       │   │   focus_stack_tile.py         # Widget principal de tile de stack
│       │   │   focus_stack_tile_setup.py   # Setup de UI
│       │   │   focus_stack_tile_events.py  # Eventos
│       │   │   focus_stack_tile_paint.py   # Pintado
│       │   │   focus_stack_tile_drag.py    # Drag & drop
│       │   │
│       │   ├─── FolderTreeSidebar (6 archivos)
│       │   │   folder_tree_sidebar.py      # Widget principal del árbol
│       │   │   folder_tree_model.py        # Modelo del árbol
│       │   │   folder_tree_delegate.py     # Delegate del árbol
│       │   │   folder_tree_handlers.py     # Handlers de eventos
│       │   │   folder_tree_drag_handler.py # Drag & drop
│       │   │   folder_tree_styles.py       # Estilos del árbol
│       │   │
│       │   ├─── Grid Layout & Selection (6 archivos)
│       │   │   grid_layout_engine.py      # Motor de layout
│       │   │   grid_layout_config.py      # Configuración
│       │   │   grid_selection_logic.py     # Lógica de selección
│       │   │   grid_selection_manager.py   # Gestor de selección
│       │   │   grid_tile_positions.py      # Posicionamiento
│       │   │   grid_tile_animations.py     # Animaciones
│       │   │
│       │   ├─── Drag & Drop (6 archivos)
│       │   │   drag_common.py              # Utilidades comunes de drag
│       │   │   drag_preview_helper.py      # Preview de drag
│       │   │   tile_drag_handler.py        # Handler de drag de tiles
│       │   │   container_drag_handler.py   # Handler de drag de contenedor
│       │   │   file_drop_handler.py       # Handler de drop de archivos
│       │   │   list_drag_handler.py        # Handler de drag de lista
│       │   │
│       │   └─── Otros Widgets (13 archivos)
│       │       file_stack_tile.py          # Tile para stacks
│       │       desktop_stack_tile.py       # Tile de escritorio
│       │       settings_stack_tile.py      # Tile de configuración
│       │       state_badge_widget.py       # Badge de estado
│       │       badge_overlay_widget.py    # Overlay de badges
│       │       view_toolbar.py             # Barra de herramientas
│       │       window_header.py            # Encabezado de ventana
│       │       raycast_panel.py            # Panel raycast
│       │       dock_separator.py           # Separador de dock
│       │       text_elision.py             # Elisión de texto
│       │       file_state_migration.py     # Migración de estados
│       │       toolbar_button_styles.py    # Estilos de botones
│       │       toolbar_navigation_buttons.py # Botones de navegación
│       │       toolbar_state_buttons.py    # Botones de estado
│       │
│       └───windows                   # Ventanas principales (20 archivos)
│           │   __init__.py
│           │
│           ├─── MainWindow (5 archivos)
│           │   main_window.py              # Ventana principal de la aplicación
│           │   main_window_setup.py        # Setup de UI
│           │   main_window_signals.py      # Conexión de señales
│           │   main_window_state.py        # Gestión de estado
│           │   main_window_file_handler.py # Manejo de archivos
│           │
│           ├─── DesktopWindow (1 archivo)
│           │   desktop_window.py           # Ventana de escritorio (auto-start)
│           │
│           ├─── QuickPreviewWindow (10 archivos)
│           │   quick_preview_window.py     # Ventana principal de preview rápido
│           │   quick_preview_ui_setup.py   # Setup de UI
│           │   quick_preview_loader.py     # Carga de previews
│           │   quick_preview_cache.py      # Caché de previews
│           │   quick_preview_pdf_handler.py # Manejo de PDFs
│           │   quick_preview_thumbnails.py # Thumbnails de preview
│           │   quick_preview_thumbnail_widget.py # Widget de thumbnail
│           │   quick_preview_navigation.py # Navegación
│           │   quick_preview_animations.py # Animaciones
│           │   quick_preview_header.py     # Encabezado
│           │   quick_preview_styles.py     # Estilos
│           │
│           └─── Diálogos (2 archivos)
│               bulk_rename_dialog.py      # Diálogo de renombrado masivo
│               trash_delete_dialog.py      # Diálogo de confirmación de eliminación
│
├───assets                           # Recursos globales
│   ├───icons                        # Iconos SVG genéricos
│   │       README.md
│   │       ajustes.svg
│   │       archive.svg
│   │       code.svg
│   │       config.svg
│   │       doc.svg
│   │       escritorio.svg
│   │       exe.svg
│   │       folder icon.svg
│   │       folder_sidebar.svg
│   │       generic.svg
│   │       media.svg
│   │       sheet.svg
│   │       slide.svg
│   │       text.svg
│   │
│   └───poppler                      # Binarios Poppler (PDF rendering)
│       └───bin
│               [archivos DLL y ejecutables de Poppler]
│
├───build                            # Build de PyInstaller
│   └───main
│           [archivos de build]
│
├───dist                             # Distribución
│   └───main
│           [archivos de distribución]
│
├───scripts                          # Automatización
│       build_release.bat            # Script de build para release
│
├───storage                          # Datos persistentes
│       claritydesk.db               # Base de datos SQLite (estados de archivos)
│       tabs.json                    # Estado de tabs (JSON)
│       dock_files/                  # Archivos del dock
│       trash/                       # Papelera
│           files/                   # Archivos eliminados
│           metadata.json            # Metadata de papelera
│
└───tests                            # Pruebas unitarias
        __init__.py
        test_files_controller.py
        test_focus_controller.py
        test_tabs_controller.py

═══════════════════════════════════════════════════════════════

RESUMEN DE ESTRUCTURA:

ARCHITECTURA (4 capas):
├── models/      → Datos puros (2 archivos)
├── services/    → Lógica de negocio (59 archivos)
├── managers/    → Orquestación (9 archivos)
└── ui/          → Interfaz visual (93 archivos)
    ├── widgets/ → Componentes reutilizables (73 archivos)
    └── windows/ → Ventanas principales (20 archivos)

ESTADÍSTICAS:
- Total archivos Python: ~163 archivos
- Models: 2 archivos
- Services: 59 archivos (organizados en 7 dominios)
- Managers: 9 archivos
- UI Widgets: 73 archivos (organizados en 10 grupos)
- UI Windows: 20 archivos (organizados en 4 grupos)

ORGANIZACIÓN POR DOMINIOS:

SERVICES (59 archivos):
├── Tab Management (9 archivos)
├── File Operations (9 archivos)
├── Icons & Preview (24 archivos)
├── File State Storage (6 archivos)
├── Trash (3 archivos)
├── Desktop (5 archivos)
└── System Services (4 archivos)

UI/WIDGETS (73 archivos):
├── FileGridView (9 archivos)
├── FileTile (9 archivos)
├── FileListView (8 archivos)
├── FileViewContainer (5 archivos)
├── FocusDockWidget (6 archivos)
├── FocusStackTile (5 archivos)
├── FolderTreeSidebar (6 archivos)
├── Grid Layout & Selection (6 archivos)
├── Drag & Drop (6 archivos)
└── Otros Widgets (13 archivos)

UI/WINDOWS (20 archivos):
├── MainWindow (5 archivos)
├── DesktopWindow (1 archivo)
├── QuickPreviewWindow (10 archivos)
└── Diálogos (2 archivos)

NOTAS:
- Estructura basada en análisis completo del proyecto
- Todos los archivos cumplen con las reglas de arquitectura (v2.1)
- Separación estricta de capas: models → services → managers → ui
- Archivos organizados por responsabilidad única
- Cohesión sobre fragmentación: widgets principales + módulos auxiliares
